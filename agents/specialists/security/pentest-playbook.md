# üîç Pentest Playbook

> **Type**: Specialist
> **Domain**: Security Testing
> **Authority**: Manual security testing, vulnerability verification

## üéØ Mission

Define and execute manual penetration testing procedures for WordPress plugins and themes. Own security test scripts, vulnerability verification, and security testing methodologies.

## üì• Inputs

- Target feature/component
- Threat model findings
- Authentication flows
- API endpoints

## üì§ Outputs

- Test procedures
- Vulnerability reports
- Proof-of-concept code
- Remediation verification

---

## üîß When to Use

‚úÖ **Use this agent when:**
- Validating threat model findings
- Testing authentication flows
- Verifying vulnerability fixes
- Pre-release security testing
- Finding bypasses in controls

‚ùå **Don't use for:**
- Automated scanning
- Code-level review
- Architecture decisions
- Compliance checking

---

## ‚ö†Ô∏è Common Pitfalls

| Pitfall | Prevention |
|---------|------------|
| Testing in production | Always use staging/test environment |
| Missing scope definition | Document allowed/forbidden actions |
| No authorization | Get written permission |
| Incomplete testing | Use systematic checklists |
| Poor documentation | Record all findings with evidence |

---

## ‚úÖ Checklist

### Preparation
- [ ] Authorization documented
- [ ] Scope defined
- [ ] Test environment ready
- [ ] Backup available
- [ ] Tools configured

### Authentication Testing
- [ ] Brute force protection
- [ ] Session management
- [ ] Password policies
- [ ] 2FA bypass attempts
- [ ] OAuth flow testing

### Authorization Testing
- [ ] Horizontal privilege testing
- [ ] Vertical privilege testing
- [ ] Direct object access
- [ ] Role boundary testing

### Input Testing
- [ ] SQL injection
- [ ] XSS (reflected, stored, DOM)
- [ ] Command injection
- [ ] Path traversal
- [ ] SSRF attempts

### Documentation
- [ ] Steps to reproduce
- [ ] Evidence (screenshots, requests)
- [ ] Impact assessment
- [ ] Remediation status

---

## üí¨ Example Prompts

### Claude Code
```
@pentest-playbook Create a test procedure for verifying our
REST API authentication. Cover token validation, session
handling, and privilege escalation attempts.
```

### Cursor
```
Using pentest-playbook, design tests for the file upload feature.
Test for: path traversal, file type bypass, size limit bypass.
```

### GitHub Copilot
```
# Pentest Task: Admin Settings Security
#
# Target: /wp-admin/admin.php?page=my-plugin
# Auth: Administrator role required
#
# Test for:
# - CSRF protection bypass
# - XSS in settings fields
# - Unauthorized access from lower roles
#
# Provide: test steps, expected results, evidence collection
```

### General Prompt
```
Create a penetration testing checklist for:
1. User registration flow
2. Password reset mechanism
3. Profile update functionality
4. Data export feature

Include specific payloads and expected responses.
```

---

## üîó Related Agents

| Agent | Relationship |
|-------|--------------|
| [threat-modeling](threat-modeling.md) | Test targets |
| [wp-security-patterns](wp-security-patterns.md) | Expected controls |
| [secrets-and-supply-chain](secrets-and-supply-chain.md) | Credential testing |
| [risk-manager](../../orchestrators/risk-manager.md) | Risk assessment |

---

## üìã Authentication Testing

### Session Management

```markdown
## Session Testing Procedure

### T1: Session Fixation
1. Open browser A, note session cookie value
2. Copy session cookie to browser B
3. Log in on browser A
4. Check if browser B is now authenticated

**Expected**: Session ID should change on authentication
**Evidence**: Screenshot before/after cookie values

### T2: Session Timeout
1. Log in and note current time
2. Wait for configured timeout period
3. Attempt to access protected resource

**Expected**: Session should be invalidated
**Evidence**: HTTP response showing redirect to login

### T3: Concurrent Sessions
1. Log in on browser A
2. Log in on browser B (same account)
3. Perform action on browser A

**Expected**: Based on policy (allow/deny concurrent)
**Evidence**: Response from both sessions
```

### Password Reset

```markdown
## Password Reset Testing

### T4: Token Prediction
1. Request password reset for test account
2. Note reset token format
3. Request multiple resets, analyze token pattern

**Expected**: Tokens should be unpredictable (cryptographic random)
**Evidence**: Multiple token values, entropy analysis

### T5: Token Reuse
1. Request password reset
2. Use reset link once
3. Try to use same link again

**Expected**: Token invalidated after use
**Evidence**: Error message on second attempt

### T6: Account Enumeration
1. Request reset for existing user
2. Request reset for non-existent user
3. Compare responses

**Expected**: Same response for both cases
**Evidence**: HTTP responses side-by-side
```

---

## üîê Authorization Testing

### Horizontal Privilege Escalation

```markdown
## Horizontal Access Testing

### T7: Direct Object Reference
1. Log in as User A
2. Access User A's resource: /my-plugin/v1/items/123
3. Note response
4. Access User B's resource: /my-plugin/v1/items/456

**Expected**: 403 Forbidden for other user's resource
**Evidence**: Both HTTP responses

### T8: Parameter Manipulation
1. Log in as User A
2. View profile page (note user_id parameter)
3. Change user_id to User B's ID in URL

**Expected**: Access denied or redirect
**Evidence**: Modified request and response
```

### Vertical Privilege Escalation

```markdown
## Privilege Escalation Testing

### T9: Role Boundary
1. Log in as Subscriber
2. Access admin-only endpoint: /wp-admin/admin.php?page=my-plugin
3. Log in as Editor
4. Access admin-only endpoint

**Expected**: Both should be denied
**Evidence**: HTTP responses for each role

### T10: Hidden Form Fields
1. View form as Subscriber
2. Modify role field to "administrator"
3. Submit form

**Expected**: Server-side validation rejects
**Evidence**: Request with modified field, response
```

---

## üíâ Input Testing

### SQL Injection

```markdown
## SQLi Testing Procedure

### Test Payloads
1. Basic string escape: `' OR '1'='1`
2. Comment injection: `admin'--`
3. Union select: `' UNION SELECT null,null,null--`
4. Time-based blind: `' AND SLEEP(5)--`
5. Error-based: `' AND 1=CONVERT(int,(SELECT @@version))--`

### Test Locations
- [ ] Search fields
- [ ] Filter parameters
- [ ] Sort parameters
- [ ] ID parameters in URLs
- [ ] Hidden form fields

### T11: Search Field SQLi
1. Navigate to search feature
2. Enter: `test' OR '1'='1`
3. Submit search

**Expected**: No SQL error, search returns expected results only
**Evidence**: Request/response, any error messages
```

### Cross-Site Scripting

```markdown
## XSS Testing Procedure

### Test Payloads
1. Basic: `<script>alert('XSS')</script>`
2. Event handler: `<img src=x onerror=alert('XSS')>`
3. SVG: `<svg onload=alert('XSS')>`
4. Encoded: `&#x3C;script&#x3E;alert('XSS')&#x3C;/script&#x3E;`
5. Filter bypass: `<scr<script>ipt>alert('XSS')</script>`

### Test Locations
- [ ] Text input fields
- [ ] Rich text editors
- [ ] URL parameters
- [ ] Headers (User-Agent, Referer)
- [ ] File upload names

### T12: Stored XSS in Profile
1. Navigate to profile edit
2. Enter payload in name field: `Test<script>alert(1)</script>`
3. Save profile
4. View profile as another user

**Expected**: Script should not execute
**Evidence**: View source of rendered page
```

---

## üìÅ File Upload Testing

```markdown
## File Upload Testing

### T13: Extension Bypass
Test files:
- `malicious.php.jpg`
- `malicious.php%00.jpg`
- `malicious.pHp`
- `malicious.php::$DATA`

Upload each and check if accessible/executable.

### T14: Content Type Bypass
1. Create PHP file
2. Set Content-Type header to `image/jpeg`
3. Upload file

**Expected**: Server validates actual file content, not just header

### T15: Size Limit Bypass
1. Note file size limit
2. Try uploading larger file
3. Try chunked upload if available

**Expected**: All upload methods enforce size limit

### T16: Path Traversal
Filenames to test:
- `../../../wp-config.php`
- `....//....//....//etc/passwd`
- `file%2e%2e%2fpasswd`

**Expected**: Filename should be sanitized, no directory traversal
```

---

## üìä Vulnerability Report Template

```markdown
# Security Vulnerability Report

## Summary
**ID**: VUL-2024-001
**Title**: Stored XSS in User Profile
**Severity**: High
**CVSS**: 7.5
**Status**: Open

## Description
A stored XSS vulnerability exists in the user profile bio field. Malicious JavaScript can be injected and will execute when the profile is viewed by other users, including administrators.

## Affected Component
- Plugin: my-plugin v1.2.3
- File: includes/class-profile.php
- Function: render_profile_bio()

## Steps to Reproduce
1. Log in as any registered user
2. Navigate to /wp-admin/profile.php
3. In the "Bio" field, enter: `<script>alert(document.cookie)</script>`
4. Click "Update Profile"
5. Have another user (or admin) view the profile

## Evidence
[Screenshot of XSS popup]
[HTTP request/response]

## Impact
- Session hijacking of administrators
- Privilege escalation
- Data theft
- Malware distribution

## Remediation
Apply output escaping when rendering the bio field:

```php
// Before (vulnerable)
echo $user_bio;

// After (fixed)
echo esc_html( $user_bio );
```

## Timeline
- **Discovered**: 2024-01-15
- **Reported**: 2024-01-16
- **Fixed**: [Pending]
- **Verified**: [Pending]
```

---

## üõ†Ô∏è Testing Tools

### Browser Developer Tools
- Network tab for request/response
- Console for JavaScript errors
- Application tab for cookies/storage

### Proxy Tools
- Burp Suite (intercept/modify requests)
- OWASP ZAP (automated + manual)
- mitmproxy (command-line)

### Payloads
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings)
- [SecLists](https://github.com/danielmiessler/SecLists)

### WordPress-Specific
- WPScan for enumeration
- WordPress test install
- Debug logging enabled
